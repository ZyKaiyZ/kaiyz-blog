---
title: 因中文字編碼 ILogger.Moq 拋出例外
author: Kaiyz
pubDatetime: 2023-12-05T00:00:00Z
postSlug: post3-20231205
featured: false
draft: true
tags:
  - unit-test
  - csharp
description: 在撰寫 Unit Tests 的時候遇到一個編碼問題...
---

## 問題
使用以下套件時 [ILogger.Moq](https://github.com/adrianiftode/Moq.ILogger) 在 Local 環境執行皆正常通過測試，但是當部屬於 Azure Dev 環境時卻出現以下錯誤

```
Error Message:
   Moq.VerifyLogException : 
Expected invocation on the mock at least once, but was never performed: logger => logger.LogInformation("�Ƶ{�^���d�L��taskQueneItem.", new[] {  })


---- Moq.MockException : 
Expected invocation on the mock at least once, but was never performed: logger => logger.Log<It.IsAnyType>(LogLevel.Information, It.IsAny<EventId>(), It.Is<It.IsAnyType>((v, t) => VerifyLogExtensions.CompareMessages("�Ƶ{�^���d�L��taskQueneItem.", VerifyLogExpression, v)), It.IsAny<Exception>(), (Func<It.IsAnyType, Exception, string>)It.IsAny<object>())

Performed invocations:

   Mock<ILogger<WorkerMgmtService>:4> (logger):

      ILogger.Log<FormattedLogValues>(LogLevel.Information, 0, taskQueneId: d735f4df-4ef6-4417-8998-238ef9ff4bef, processStatus: Success, null, Func<FormattedLogValues, Exception, string>)
      ILogger.Log<FormattedLogValues>(LogLevel.Information, 0, 排程回報查無該taskQueneItem., null, Func<FormattedLogValues, Exception, string>)

  Stack Trace:
     at Moq.VerifyLogExtensions.Verify[T](Mock`1 loggerMock, Expression`1 expression, Nullable`1 times, Func`1 timesFunc, String failMessage)
   at Moq.VerifyLogExtensions.VerifyLog[T](Mock`1 loggerMock, Expression`1 expression)
```
但當以英文作為字串測試時，卻於 Dev 環境正常通過測試，初步判斷是中文字比較時因編碼格式導致測試失敗